# Milestone v1.0: MVP

**Status:** SHIPPED 2026-02-05
**Phases:** 1-4
**Total Plans:** 14

## Overview

Build CloudMount from foundation to functional product: start with app shell and macFUSE detection, implement core mount/unmount with directory browsing, add file read/write operations, and finish with configuration UI and polish. Each phase delivers observable capabilities that build toward the complete experience of mounting cloud storage as native macOS volumes.

## Phases

### Phase 1: Foundation

**Goal**: Users can launch the app, verify macFUSE is installed, and have credentials securely stored
**Depends on**: Nothing (first phase)
**Plans**: 4 plans

Plans:

- [x] 01-01: Initialize menu bar app with system tray icon (Swift/SwiftUI MenuBarExtra)
- [x] 01-02: Implement macFUSE detection with installation guidance (FileManager-based)
- [x] 01-03: Create secure credential storage using macOS Keychain (KeychainAccess library)
- [x] 01-04: Build settings window skeleton (Native SwiftUI TabView)

**Details:**
Phase 1 pivoted from Tauri/React to native Swift/SwiftUI mid-execution for better native UX. The original Tauri implementation (plans 01-01 through 01-03) was replaced with Swift equivalents. Plan 01-04 built the settings window using native SwiftUI TabView.

**Requirements:** MOUNT-04, CONFIG-03, CONFIG-04, UI-01, ERROR-03
**Completed:** 2026-02-02

### Phase 2: Core Mount & Browse

**Goal**: Users can mount buckets as local volumes and browse directories in Finder
**Depends on**: Phase 1
**Plans**: 4 plans

Plans:

- [x] 02-01: Implement FUSE filesystem trait with getattr and readdir
- [x] 02-02: Build B2 API client and mount manager for lifecycle control
- [x] 02-03: Add metadata caching layer for directory performance (Moka sync)
- [x] 02-04: Integrate mount status with status bar menu via Unix socket IPC

**Details:**
Established the dual-process architecture: Rust daemon for FUSE operations, Swift app for UI. Unix domain socket IPC connects them. B2 API client handles authentication and file listing. Metadata caching with Moka reduces API calls by 80%+. DaemonClient (Swift actor) polls status every 2 seconds.

**Requirements:** MOUNT-01, MOUNT-02, MOUNT-03, FILE-01, FILE-05, UI-02, UI-04
**Completed:** 2026-02-03

### Phase 3: File I/O

**Goal**: Users can read, write, and delete files through the mounted volume
**Depends on**: Phase 2
**Plans**: 4 plans

Plans:

- [x] 03-01: File Read with Local Caching & API Minimization
- [x] 03-02: File Write with Upload on Close
- [x] 03-03: File Delete, Mkdir, and Rename Operations
- [x] 03-04: Error Handling, Retry Logic, and Connection Health

**Details:**
Implemented complete file I/O through FUSE. Read operations cache file content locally. Write operations buffer locally and upload to B2 on file close. Delete uses permanent delete (ignoring B2 versioning). Rename implemented via server-side copy + delete. Directory rename returns ENOSYS (not supported for MVP). macOS metadata files (._*, .DS_Store) suppressed in FUSE lookup. B2Client uses Arc<RwLock<AuthState>> for token refresh. Retry wrapper with exponential backoff (500ms, 1s, 2s, 3 retries).

**Requirements:** FILE-02, FILE-03, FILE-04, ERROR-01, ERROR-02
**Completed:** 2026-02-03

### Phase 4: Configuration & Polish

**Goal**: Users can configure buckets through the UI and see complete status information
**Depends on**: Phase 3
**Plans**: 2 plans

Plans:

- [x] 04-01: Bucket config persistence and disk usage IPC protocol
- [x] 04-02: Disk usage display in menu and settings polish

**Details:**
BucketConfigStore persists configs to ~/Library/Application Support/CloudMount/buckets.json using Codable. CodingKeys exclude runtime state (isMounted, totalBytesUsed). IPC protocol extended with total_bytes_used: Option<u64> (sends None for MVP — B2 has no bucket size API). Menu bar shows formatted disk usage via ByteCountFormatter. Mount point validation prepends /Volumes/ for non-absolute paths.

**Requirements:** CONFIG-01, CONFIG-02, UI-03, UI-05
**Completed:** 2026-02-03

---

## Milestone Summary

**Decimal Phases:** None

**Key Decisions:**

- PIVOT: Tauri/React → Native Swift/SwiftUI (Rationale: Better native macOS UX)
- Rust daemon for FUSE, Swift for UI, Unix socket IPC (Rationale: FUSE requires C-compatible callbacks)
- Global B2 credentials, not per-bucket (Rationale: MVP simplicity)
- Write locally, upload sync on close (Rationale: MVP simplicity, avoids partial uploads)
- Suppress macOS metadata files in FUSE lookup (Rationale: Reduce unnecessary B2 API calls)
- Permanent delete ignoring B2 versioning (Rationale: MVP simplicity)
- Rename via server-side copy + delete (Rationale: B2 has no rename API)
- Directory rename returns ENOSYS (Rationale: Complex operation deferred for MVP)
- totalBytesUsed sends None for MVP (Rationale: B2 has no bucket size API)
- moka::sync::Cache for FUSE compatibility (Rationale: FUSE callbacks are synchronous)

**Issues Resolved:**

- Tauri text field focus bug → resolved by pivoting to native SwiftUI
- Settings window activation issues → Window scene instead of Settings scene
- B2 API v3 URL corrections for mount error reporting
- Empty directory listing bugs in FUSE readdir

**Issues Deferred:**

- Pre-existing test failure: cache::metadata::tests::test_cache_clear (moka cache timing) — cosmetic
- Actual disk usage computation (B2 has no bucket size API, requires listing all files)

**Technical Debt Incurred:**

- totalBytesUsed always returns None (protocol wired but no computation)
- Directory rename not supported (returns ENOSYS)
- Auth token refresh is basic (24h expiry, simple re-auth)
- list_stored_buckets returns empty list (keyring v3 doesn't support listing entries)

---

*For current project status, see .planning/PROJECT.md*
