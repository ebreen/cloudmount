---
phase: 08-distribution
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - homebrew/cloudmount.rb
  - appcast.xml
autonomous: true

must_haves:
  truths:
    - "Homebrew Cask formula has version, sha256, url, livecheck, depends_on macos, caveats, and zap stanza"
    - "Cask caveats include extension enable steps, macOS requirement, mount/unmount tips, and support link"
    - "Cask zap stanza is conservative (prefs, caches, saved state — no user data)"
    - "Cask includes auto_updates true (Sparkle handles updates)"
    - "Placeholder appcast.xml exists for Sparkle feed"
    - "livecheck uses :github_latest strategy"
  artifacts:
    - path: "homebrew/cloudmount.rb"
      provides: "Homebrew Cask formula template for tap repository"
      contains: "cask.*cloudmount"
    - path: "appcast.xml"
      provides: "Sparkle appcast feed placeholder"
      contains: "rss.*sparkle"
  key_links:
    - from: "homebrew/cloudmount.rb"
      to: "GitHub Releases"
      via: "download URL pattern"
      pattern: "github.com.*releases.*download"
    - from: ".github/workflows/release.yml"
      to: "homebrew/cloudmount.rb"
      via: "bump-cask job writes this template to tap repo"
      pattern: "cloudmount\\.rb"
    - from: "CloudMount/Info.plist"
      to: "appcast.xml"
      via: "SUFeedURL references this file"
      pattern: "appcast\\.xml"
---

<objective>
Create the Homebrew Cask formula template and Sparkle appcast placeholder — the two distribution channel artifacts that live in the repository.

Purpose: BREW-01 (cask formula), BREW-02 (depends_on, caveats, zap), BREW-03 (livecheck), and PKG-05 continuation (appcast for Sparkle). The cask template is what the release pipeline writes to the tap repo. The appcast is the Sparkle update feed that gets committed to main.

Output: Homebrew Cask formula template at `homebrew/cloudmount.rb` (reference for tap repo), and `appcast.xml` placeholder at repo root.
</objective>

<execution_context>
@~/.config/Claude/get-shit-done/workflows/execute-plan.md
@~/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-distribution/08-RESEARCH.md
@.planning/phases/08-distribution/08-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Homebrew Cask formula template</name>
  <files>
    homebrew/cloudmount.rb
  </files>
  <action>
    Create `homebrew/cloudmount.rb` — this is the reference template for the `eirikbreen/homebrew-cloudmount` tap repository. The release pipeline's bump-cask job generates the actual cask with the correct version and sha256, but this template serves as the canonical reference and is what gets initially placed in the tap repo.

    ```ruby
    cask "cloudmount" do
      version "2.0.0"
      sha256 "PLACEHOLDER_SHA256"

      url "https://github.com/eirikbreen/cloudmount/releases/download/v#{version}/CloudMount-#{version}.dmg"
      name "CloudMount"
      desc "Mount cloud storage as native macOS volumes via FSKit"
      homepage "https://github.com/eirikbreen/cloudmount"

      livecheck do
        url :url
        strategy :github_latest
      end

      auto_updates true
      depends_on macos: ">= :tahoe"

      app "CloudMount.app"

      zap trash: [
        "~/Library/Application Support/com.cloudmount.app",
        "~/Library/Caches/com.cloudmount.app",
        "~/Library/HTTPStorages/com.cloudmount.app",
        "~/Library/Preferences/com.cloudmount.app.plist",
        "~/Library/Saved Application State/com.cloudmount.app.savedState",
      ]

      caveats <<~EOS
        CloudMount requires macOS 26 (Tahoe) or later.

        After installation, enable the FSKit extension:
          System Settings → General → Login Items & Extensions → CloudMount

        Mount a volume:  Use the CloudMount menu bar app, or run: mount -t b2 b2://bucket /mount/point
        Unmount:          Use the menu bar app, or run: diskutil unmount /mount/point

        For help: https://github.com/eirikbreen/cloudmount
      EOS
    end
    ```

    Caveats rationale (per user context decisions):
    - Concise essentials only, not a long checklist
    - Includes: extension enable steps, macOS requirement, mount/unmount tips, support link
    - No mention of Sparkle — auto_updates true handles that

    Zap rationale (per user context decisions):
    - Conservative: removes app prefs, caches, HTTP storage, saved state
    - Does NOT remove Keychain items (user credentials) — too aggressive
    - Does NOT remove shared UserDefaults (may be used by extension)
  </action>
  <verify>
    Verify Ruby syntax: `ruby -c homebrew/cloudmount.rb` should report "Syntax OK"
  </verify>
  <done>
    `homebrew/cloudmount.rb` exists with complete Cask formula including version, sha256 placeholder, url, livecheck with :github_latest, auto_updates, depends_on macos ">= :tahoe", app stanza, conservative zap, and concise caveats with all required info.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Sparkle appcast.xml placeholder</name>
  <files>
    appcast.xml
  </files>
  <action>
    Create `appcast.xml` at the repository root — this is the Sparkle update feed referenced by `SUFeedURL` in Info.plist. It starts as an empty feed. The release workflow will update it with release entries using Sparkle's `generate_appcast` tool (or manual XML append).

    ```xml
    <?xml version="1.0" encoding="utf-8"?>
    <rss version="2.0" xmlns:sparkle="http://www.andymatuschak.org/xml-namespaces/sparkle" xmlns:dc="http://purl.org/dc/elements/1.1/">
      <channel>
        <title>CloudMount Updates</title>
        <link>https://github.com/eirikbreen/cloudmount</link>
        <description>Appcast feed for CloudMount auto-updates</description>
        <language>en</language>
        <!-- Release entries will be added by generate_appcast during CI release -->
      </channel>
    </rss>
    ```

    This file is hosted via raw.githubusercontent.com — the URL in Info.plist's SUFeedURL points to:
    `https://raw.githubusercontent.com/eirikbreen/cloudmount/main/appcast.xml`

    The generate_appcast tool (run during releases) will populate this with `<item>` entries containing the EdDSA-signed enclosure for each release DMG.
  </action>
  <verify>
    Validate XML: `xmllint --noout appcast.xml` (or `python3 -c "import xml.etree.ElementTree as ET; ET.parse('appcast.xml')"`)
  </verify>
  <done>
    `appcast.xml` exists at repo root with valid RSS/Sparkle XML structure, empty channel ready for generate_appcast to populate. Referenced by SUFeedURL in Info.plist.
  </done>
</task>

</tasks>

<verification>
1. `ruby -c homebrew/cloudmount.rb` reports "Syntax OK"
2. `xmllint --noout appcast.xml` reports no errors (or Python XML parse succeeds)
3. `grep -q "livecheck" homebrew/cloudmount.rb` confirms livecheck stanza
4. `grep -q "depends_on macos" homebrew/cloudmount.rb` confirms macOS constraint
5. `grep -q "auto_updates true" homebrew/cloudmount.rb` confirms Sparkle integration awareness
6. `grep -q "zap trash" homebrew/cloudmount.rb` confirms zap stanza
7. `grep -q "sparkle" appcast.xml` confirms Sparkle namespace
</verification>

<success_criteria>
- Cask formula has all required stanzas: version, sha256, url, name, desc, homepage, livecheck, auto_updates, depends_on, app, zap, caveats
- Caveats are concise with extension enable, macOS requirement, mount/unmount tips, support link
- Zap is conservative (no Keychain/credential removal)
- livecheck uses :github_latest pointing to releases URL
- appcast.xml is valid Sparkle-compatible RSS/XML feed
- Both files are ready for CI pipeline consumption
</success_criteria>

<output>
After completion, create `.planning/phases/08-distribution/08-03-SUMMARY.md`
</output>
