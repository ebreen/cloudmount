---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src-tauri/Cargo.toml
  - src-tauri/tauri.conf.json
  - src-tauri/src/main.rs
  - src-tauri/src/lib.rs
  - src-tauri/src/tray.rs
  - src/App.tsx
  - src/main.tsx
  - package.json
  - index.html
autonomous: true
must_haves:
  truths:
    - "User sees status bar icon immediately on app launch"
    - "Clicking icon shows dropdown menu with basic options"
    - "Menu contains Settings, About, and Quit options"
    - "App launches without errors and shows in Activity Monitor"
  artifacts:
    - path: "src-tauri/src/tray.rs"
      provides: "System tray icon and menu implementation"
      exports: ["setup_tray", "TrayState"]
    - path: "src-tauri/src/main.rs"
      provides: "Application entry point with tray setup"
    - path: "src-tauri/tauri.conf.json"
      provides: "Tauri configuration with tray-icon feature"
      contains: '"tray-icon": true'
  key_links:
    - from: "src-tauri/src/main.rs"
      to: "src-tauri/src/tray.rs"
      via: "mod tray; tray::setup_tray(&app)"
    - from: "src-tauri/src/tray.rs"
      to: "src-tauri/src/lib.rs"
      via: "Event emitters for menu actions"
---

<objective>
Initialize Tauri menu bar app with system tray icon

Purpose: Create the app shell that users interact with — a native-feeling macOS status bar application that provides immediate visual feedback on launch.

Output: Working Tauri app with system tray icon, dropdown menu, and basic menu actions (Settings, About, Quit).
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/research/STACK.md
@.planning/research/ARCHITECTURE.md

## Phase Context
Phase 1 builds the app shell: status bar icon with menu, macFUSE detection, secure credential storage, and settings window. This plan creates the foundational Tauri app structure.

## Key Decisions from Context
- Icon style: Bucket combined with cloud (unique app identity)
- Menu trigger: Dropdown menu on click (standard macOS pattern)
- Menu items: Settings, Add bucket, About, Quit (always present)
- First launch: Just show icon quietly (no auto-open menu)
- Window type: Single form view, small (400x300), top tabs

## Tech Stack
- Tauri 2.9 with tray-icon feature
- Rust backend with tokio async runtime
- React/TypeScript frontend
- macOS native menu bar integration
</context>

<tasks>

<task type="auto">
  <name>Task 1: Initialize Tauri project structure</name>
  <files>src-tauri/Cargo.toml, src-tauri/tauri.conf.json, package.json</files>
  <action>
    Create a new Tauri v2 project with the following specifications:
    
    1. Initialize with `npm create tauri-app@latest` equivalent structure OR manually create:
       - src-tauri/Cargo.toml with dependencies:
         * tauri = { version = "2.9", features = ["tray-icon"] }
         * tauri-build = "2.9"
         * tokio = { version = "1.43", features = ["full"] }
         * serde = { version = "1.0", features = ["derive"] }
         * serde_json = "1.0"
       
    2. Configure src-tauri/tauri.conf.json:
       - Enable "tray-icon" feature in tauri.allowlist or capabilities
       - Set app name to "CloudMount"
       - Configure window to be hidden by default (menu bar apps don't show window on launch)
       - Set macOS bundle identifier: "com.cloudmount.app"
    
    3. Create package.json with:
       - React + TypeScript frontend
       - @tauri-apps/api for frontend-backend communication
       - Build scripts for tauri dev and tauri build
    
    4. Create basic frontend structure:
       - index.html with root div
       - src/main.tsx as entry point
       - src/App.tsx with placeholder content
    
    IMPORTANT: Do NOT use tauri-plugin-store yet — that comes in Plan 03 for credential storage.
  </action>
  <verify>
    Run `cargo check` in src-tauri/ directory — should compile without errors
    Run `npm install` in project root — should install dependencies
  </verify>
  <done>
    Tauri project structure exists with proper Cargo.toml, tauri.conf.json, and React frontend scaffold. cargo check passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement system tray icon and menu</name>
  <files>src-tauri/src/tray.rs, src-tauri/src/main.rs, src-tauri/src/lib.rs</files>
  <action>
    Create the system tray implementation that shows the CloudMount icon in the macOS menu bar:
    
    1. Create src-tauri/src/tray.rs:
       - Define TrayState struct to hold app state
       - Implement setup_tray(app: &App) function that:
         * Creates a tray icon (use a simple template icon for now — a cloud or bucket emoji/SF symbol)
         * Sets up left-click handler to show menu
         * Creates menu items: "Settings...", "About CloudMount", "Quit"
       - Implement menu handlers:
         * Settings: Emit event "open_settings" to frontend
         * About: Emit event "open_about" to frontend  
         * Quit: Call app.exit(0)
       
    2. Update src-tauri/src/lib.rs:
       - Add pub mod tray;
       - Define any shared types/commands needed
       
    3. Update src-tauri/src/main.rs:
       - Call tray::setup_tray(&app) during app setup
       - Use tauri::Builder pattern with proper setup hook
       - Ensure app runs without showing a window initially (menu bar pattern)
       
    4. For the icon:
       - Use a simple SF Symbol or emoji initially (cloud, bucket, or drive icon)
       - Place icon in src-tauri/icons/ directory
       - Use Template mode for proper dark mode support
       
    Menu structure:
    ```
    CloudMount
    ───────────
    Settings...
    About CloudMount
    ───────────
    Quit
    ```
  </action>
  <verify>
    Run `cargo tauri dev` — app should launch and show icon in menu bar
    Click icon — dropdown menu should appear with Settings, About, Quit
    Click Quit — app should exit cleanly
  </verify>
  <done>
    System tray icon appears in macOS menu bar on launch. Clicking shows menu with Settings, About, Quit options. Quit works. No window appears on launch (menu bar app pattern).
  </done>
</task>

<task type="auto">
  <name>Task 3: Wire up frontend to handle menu events</name>
  <files>src/App.tsx, src/main.tsx</files>
  <action>
    Connect the frontend to respond to tray menu events:
    
    1. Update src/main.tsx:
       - Import necessary Tauri API modules
       - Set up event listener for "open_settings" and "open_about" events
       - Render React app
       
    2. Update src/App.tsx:
       - Create simple state management for visible windows
       - Implement Settings placeholder component (just a div saying "Settings Window")
       - Implement About placeholder component (app name, version, simple description)
       - Show appropriate component when events are received
       - Use Tauri's window API to show/hide windows
       
    3. Window behavior:
       - Settings window: Small (400x300), title "CloudMount Settings"
       - About window: Small (300x200), title "About CloudMount"
       - Both should be closable and not quit the app (menu bar pattern)
       
    4. Use @tauri-apps/api window and event modules:
       - listen() for receiving events from backend
       - Window class for creating/managing windows
  </action>
  <verify>
    Run `cargo tauri dev`
    Click tray icon → Settings — Settings window should appear
    Click tray icon → About — About window should appear
    Close window — app should remain running (icon still in menu bar)
    Click Quit — app should exit
  </verify>
  <done>
    Clicking Settings in menu opens settings window. Clicking About opens about window. Closing windows doesn't quit app. Menu bar app pattern working correctly.
  </done>
</task>

</tasks>

<verification>
1. App launches with `cargo tauri dev` and shows icon in menu bar immediately
2. Clicking icon shows dropdown menu with Settings, About, Quit
3. Settings and About open their respective windows
4. Quit exits the app cleanly
5. No terminal errors during operation
</verification>

<success_criteria>
- Status bar icon visible immediately on app launch
- Menu appears on icon click with all required items
- Settings and About windows open correctly
- App follows menu bar app pattern (no dock icon, stays running when windows closed)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
