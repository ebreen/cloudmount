---
phase: 01-foundation
plan: 04
type: execute
wave: 2
depends_on: ["01-01", "01-03"]
files_modified:
  - src/components/SettingsWindow.tsx
  - src/components/CredentialsForm.tsx
  - src/App.tsx
  - src-tauri/src/commands.rs
  - src/styles/settings.css
autonomous: false
must_haves:
  truths:
    - "Settings window opens from status bar menu"
    - "Settings has tabs for Buckets, Credentials, and General"
    - "Credentials tab has form for Application Key ID and Application Key"
    - "Form validates input and saves to Keychain"
    - "Settings window is compact (400x300) with native macOS appearance"
  artifacts:
    - path: "src/components/SettingsWindow.tsx"
      provides: "Main settings window with tab navigation"
    - path: "src/components/CredentialsForm.tsx"
      provides: "Credential input form with validation"
    - path: "src/styles/settings.css"
      provides: "Native macOS styling for settings window"
  key_links:
    - from: "src/components/SettingsWindow.tsx"
      to: "src/components/CredentialsForm.tsx"
      via: "Tab content rendering"
    - from: "src/components/CredentialsForm.tsx"
      to: "src-tauri/src/commands.rs"
      via: "invoke('save_bucket_credentials')"
---

<objective>
Build settings window skeleton with credentials configuration

Purpose: Provide a compact, native-feeling settings window where users can configure their Backblaze B2 credentials and manage bucket settings.

Output: Settings window with tab navigation (Buckets, Credentials, General), functional credentials form with validation, and integration with secure Keychain storage.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@.planning/phases/01-foundation/01-03-SUMMARY.md

## Phase Context
This plan implements the settings window UI for CONFIG-01 and CONFIG-02 (partial). It builds on the app shell (01-01) and credential storage (01-03).

## Key Decisions from Context
- Window type: Single form view with top tabs for sections
- Window size: Small (400x300)
- Sections: Buckets, Credentials, General
- Opening settings: Only from status bar menu
- Save behavior: Auto-save on change (or explicit save button)
- Validation: Inline with fields (not popup alerts)
- Credential fields: Application Key ID and Application Key
- Security visibility: Masked by default (password dots with reveal toggle)

## UI/UX Requirements
- Native macOS appearance
- Compact size (400x300)
- Tab navigation at top
- Credentials form with:
  * Bucket name input
  * Application Key ID input
  * Application Key input (masked)
  * Show/hide toggle for key
  * Save button
  * Success/error feedback
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create settings window component with tab navigation</name>
  <files>src/components/SettingsWindow.tsx, src/styles/settings.css</files>
  <action>
    Create the main settings window with native macOS styling:
    
    1. Create src/components/SettingsWindow.tsx:
       - Props: { isOpen: boolean, onClose: () => void, initialTab?: string }
       - State: activeTab ('buckets' | 'credentials' | 'general')
       - Tab navigation at top:
         * Buckets — bucket list and mount configuration
         * Credentials — B2 credential management
         * General — app preferences
       - Window styling:
         * Compact size: 400x300 minimum
         * Native macOS appearance
         * Centered on screen when opened
         * Close button in top-left (macOS standard)
       
    2. Create src/styles/settings.css:
       - macOS-native styling:
         * System fonts (-apple-system, BlinkMacSystemFont)
         * Native button styles
         * Tab bar appearance like macOS System Preferences
         * Subtle shadows and borders
         * Proper spacing (macOS HIG compliant)
       - Dark mode support using @media (prefers-color-scheme: dark)
       
    3. Tab content areas:
       - BucketsTab: Placeholder for now ("Bucket configuration coming in Phase 2")
       - CredentialsTab: Renders CredentialsForm component
       - GeneralTab: Placeholder for app preferences
       
    4. Integration with App.tsx:
       - Replace placeholder settings window with SettingsWindow
       - Pass isOpen based on state
       - Handle onClose to hide window (not quit app)
  </action>
  <verify>
    Run `cargo tauri dev`
    Click tray icon → Settings — Settings window opens
    Window shows three tabs: Buckets, Credentials, General
    Tabs are clickable and switch content
    Window has native macOS appearance
    Close button hides window (app keeps running)
  </verify>
  <done>
    Settings window opens from menu. Three tabs visible and functional. Native macOS styling. Window closes without quitting app.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create credentials form with validation</name>
  <files>src/components/CredentialsForm.tsx</files>
  <action>
    Create the credentials input form for the Credentials tab:
    
    1. Create src/components/CredentialsForm.tsx:
       - State management:
         * bucketName: string
         * keyId: string
         * applicationKey: string
         * showKey: boolean (toggle visibility)
         * isSaving: boolean
         * saveStatus: 'idle' | 'success' | 'error'
         * errorMessage: string
         
       - Form fields:
         * Bucket Name: text input, placeholder "my-bucket-name"
         * Application Key ID: text input, placeholder "004..."
         * Application Key: password input (masked), placeholder "K004..."
         * Show/Hide toggle button next to Application Key
         
       - Validation:
         * All fields required
         * Key ID should look like Backblaze format (starts with digits)
         * Application key should be long enough
         * Show inline validation errors (red text below field)
         
       - Save functionality:
         * Save button (disabled while saving or invalid)
         * On click: call invoke('save_bucket_credentials', ...)
         * Show success checkmark or error message
         * Clear form on success (optional)
         
       - UX details:
         * Auto-save on blur (optional, can defer)
         * Subtle success animation (checkmark fade)
         * Error messages below relevant field
         * Loading state on save button
         
    2. Security:
       - Application Key field always type="password" unless showKey is true
       - Never log credential values
       - Clear sensitive data from memory when possible
       
    3. Styling:
       - Form layout: labels above inputs
       - Proper spacing between fields
       - Save button aligned right (macOS standard)
       - Help text: "Find these in your Backblaze B2 account"
  </action>
  <verify>
    Run `cargo tauri dev`
    Open Settings → Credentials tab
    Form shows three fields: Bucket Name, Application Key ID, Application Key
    Application Key is masked by default
    Show/Hide toggle works
    Validation shows errors for empty fields
    Save button calls Tauri command (check Network tab or add console.log)
    Success feedback appears after save
  </verify>
  <done>
    Credentials form has all three fields. Key is masked with toggle. Validation works. Save calls Tauri command. Success/error feedback visible.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify settings window UX</name>
  <what-built>
    Settings window with tab navigation and credentials form. The window opens from the status bar menu, has three tabs (Buckets, Credentials, General), and the Credentials tab has a form for entering Backblaze B2 credentials with validation and save functionality.
  </what-built>
  <how-to-verify>
    1. Run the app with `cargo tauri dev`
    2. Click the CloudMount icon in the menu bar
    3. Click "Settings..." — Settings window should open
    4. Verify window appearance:
       - [ ] Window is compact (~400x300)
       - [ ] Has native macOS look and feel
       - [ ] Three tabs at top: Buckets, Credentials, General
    5. Click "Credentials" tab
    6. Verify form:
       - [ ] Three fields: Bucket Name, Application Key ID, Application Key
       - [ ] Application Key is masked (dots)
       - [ ] Show/Hide toggle works
    7. Test validation:
       - [ ] Click Save with empty fields — shows validation errors
    8. Test save (optional — can use fake credentials):
       - [ ] Enter test values
       - [ ] Click Save
       - [ ] Success feedback appears
    9. Close window:
       - [ ] Click red close button
       - [ ] App should remain running (icon still in menu bar)
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. Settings window opens from status bar menu
2. Window has three tabs: Buckets, Credentials, General
3. Credentials tab has form with all required fields
4. Application Key is masked with show/hide toggle
5. Validation shows inline errors
6. Save button works and shows feedback
7. Window closes without quitting app
8. Native macOS appearance throughout
</verification>

<success_criteria>
- Settings window accessible from menu bar
- Tab navigation works (Buckets, Credentials, General)
- Credentials form has Bucket Name, Key ID, Application Key fields
- Application Key masked by default with toggle
- Form validation works inline
- Save persists to Keychain
- Native macOS styling
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-04-SUMMARY.md`
</output>
